<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digital elevation model • rgugik</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Digital elevation model">
<meta property="og:description" content="rgugik">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rgugik</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/orthophotomap.html">Orthophotomap</a>
    </li>
    <li>
      <a href="../articles/DEM.html">Digital Elevation Model</a>
    </li>
    <li>
      <a href="../articles/topodb.html">Topographic Database</a>
    </li>
    <li>
      <a href="../articles/articles/spatialdb_description.html">Spatial Databases</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kadyb/rgugik/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="DEM_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Digital elevation model</h1>
                        <h4 class="author">Krzysztof Dyba, Jakub Nowosad</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kadyb/rgugik/blob/master/vignettes/DEM.Rmd"><code>vignettes/DEM.Rmd</code></a></small>
      <div class="hidden name"><code>DEM.Rmd</code></div>

    </div>

    
    
<style>
body {text-align: justify}
</style>
<div id="definition" class="section level2">
<h2 class="hasAnchor">
<a href="#definition" class="anchor"></a>Definition</h2>
<p><strong>Digital elevation models</strong> are models describing the terrain surface. They are created as a result of the processing of aerial photos, laser scanning (LiDAR), geodetic surveying, or radar interferometry (InSAR). DEMs are one of the key datasets in Geographic Information Systems (GIS) and constitute the basis for many environmental spatial analyses. In addition, they are a source for derived products such as terrain slope and aspect. DEM is the general name for a group of models with different characteristics, including:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Digital terrain model</strong> (DTM) - numerical representation of the terrain with its morphological forms. This model is devoid of any objects above the ground, such as buildings or trees.</li>
<li>
<strong>Digital surface model</strong> (DSM) - numerical representation of the terrain, including objects on its surface, such as buildings and trees.</li>
</ol>
<center>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/DTM_DSM.svg/1024px-DTM_DSM.svg.png" title="fig:" style="width:50.0%" alt="DTM-DSM"><p style="font-size:8px;">
Wikimedia Commons, the free media repository, <a href="https://commons.wikimedia.org/w/index.php?title=File:DTM_DSM.svg&amp;oldid=475779479" class="uri">https://commons.wikimedia.org/w/index.php?title=File:DTM_DSM.svg&amp;oldid=475779479</a> (accessed October 7, 2020).
</p>
</center>
<p><br></p>
<p>The properties of the DEMs:</p>
<ol style="list-style-type: decimal">
<li>Format - we can distinguish three main structures: <strong>GRID</strong> (point / cell), <strong>TIN</strong> (irregular topological triangle network) and <strong>contour lines</strong> (vector). Currently, the most used format is GRID.</li>
<li>Accuracy - is related to the vertical measurement error.</li>
<li>Spatial resolution - is related to the size of the smallest object that can be detected by the sensor and is determined by the size of the image cell (pixel). The larger the cell, the more generalized form of the terrain it presents.</li>
</ol>
</div>
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>The purpose of this vignette is to determine the elevation of the ground surface and objects in the selected area. The source of the data will be Airborne Laser Scanning already processed to the GRID format.</p>
</div>
<div id="analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis" class="anchor"></a>Analysis</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># attach packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://kadyb.github.io/rgugik/">rgugik</a></span><span class="op">)</span></code></pre></div>
<p>Our analysis area is the Morasko Meteorite nature reserve located in the Greater Poland voivodeship. It was established in 1976 in order to protect the area of impact craters, which, according to researchers, were formed in the fall of the Morasko meteorite about 5,000 years ago. In addition, the oak-hornbeam forest with rare species of plants (<em>lilium martagon</em>, <em>ceratophyllum submersum</em>) and birds (<em>european nightjar</em>, <em>black woodpecker</em>) is protected.</p>
<div id="vector-data" class="section level3">
<h3 class="hasAnchor">
<a href="#vector-data" class="anchor"></a>Vector data</h3>
<p>The centroid (geometric center) of the Morasko Meteorite nature reserve has X = 16.895 and Y = 52.487 coordinates in World Geodetic System 1984 (EPSG 4326). Let’s start by creating this point with the <strong>sf</strong> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">morasko</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16.895</span>, <span class="fl">52.489</span><span class="op">)</span><span class="op">)</span>
<span class="va">morasko</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="va">morasko</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="co"># set coordinate system</span>
<span class="va">morasko</span></code></pre></div>
<pre><code>## Geometry set for 1 feature 
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 16.895 ymin: 52.489 xmax: 16.895 ymax: 52.489
## geographic CRS: WGS 84</code></pre>
<pre><code>## POINT (16.895 52.489)</code></pre>
<p>Now our point is embedded in space (has a spatial reference). In the next step, let’s create an approximate zone that will include the area of the reserve. The function <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer()</a></code> will be used for this. Before this operation, we need to transform the coordinate system to a system with metric units, e.g. Poland CS92 (EPSG 2180), using <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">morasko</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">morasko</span>, crs <span class="op">=</span> <span class="fl">2180</span><span class="op">)</span>
<span class="va">morasko_buffer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_buffer</a></span><span class="op">(</span><span class="va">morasko</span>, dist <span class="op">=</span> <span class="fl">400</span><span class="op">)</span></code></pre></div>
<p>We have created a buffer with a radius of 400 meters. Let’s visualize it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">morasko_buffer</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">"Morasko reserve buffer"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">morasko</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="DEM-GEOMETRY-1.png"></p>
<p>Of course, the area shown above is not exactly the reserve area. The exact area can be determined from the polygon layer as in <a href="https://kadyb.github.io/rgugik/articles/orthophotomap.html">orthophotomap</a> example using the General Geographic Database.</p>
</div>
<div id="raster-data" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-data" class="anchor"></a>Raster data</h3>
<p>Now we can search for available elevation data for this area using the <code><a href="../reference/DEM_request.html">DEM_request()</a></code> function (it is analogous to the <code><a href="../reference/ortho_request.html">ortho_request()</a></code> function). The only argument of the function is our reserve buffer. Note that <code><a href="../reference/DEM_request.html">DEM_request()</a></code> takes data frame as input, and currently the <code>morasko_buffer</code> object is a list, so we need to convert it first.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">morasko_buffer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span><span class="va">morasko_buffer</span><span class="op">)</span> <span class="co"># set as data frame</span>
<span class="va">req_df</span> <span class="op">=</span> <span class="fu"><a href="../reference/DEM_request.html">DEM_request</a></span><span class="op">(</span><span class="va">morasko_buffer</span><span class="op">)</span></code></pre></div>
<p>Let’s check the obtained results.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># display the first 10 rows and the first 5 columns</span>
<span class="va">req_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>##                 sheetID year              format resolution avgElevErr
## 1        N-33-130-D-b-1 2011           ASCII TBD     25.0 m        0.9
## 2      N-33-130-D-b-1-1 2012      ASCII XYZ GRID      0.5 m        0.1
## 3      N-33-130-D-b-1-1 2012 ARC/INFO ASCII GRID      0.5 m        0.1
## 4      N-33-130-D-b-1-1 2012      ASCII XYZ GRID      1.0 m        0.1
## 5      N-33-130-D-b-1-1 2012 ARC/INFO ASCII GRID      1.0 m        0.1
## 6  N-33-130-D-b-1-1-1-4 2012                 LAS    12 p/m2        0.1
## 7  N-33-130-D-b-1-1-2-3 2012                 LAS    12 p/m2        0.1
## 8  N-33-130-D-b-1-1-2-4 2012                 LAS    12 p/m2        0.1
## 9  N-33-130-D-b-1-1-3-2 2012                 LAS    12 p/m2        0.1
## 10 N-33-130-D-b-1-1-4-1 2012                 LAS    12 p/m2        0.1</code></pre>
<p>We have received metadata with many types of data of different formats, timeliness, resolution, and accuracy. For our analysis, we need digital terrain model (DTM) and digital surface model (DSM) in the “ARC/INFO ASCII GRID” format. Let’s make data selection by creating two tables and combining them together.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">req_df_DTM</span> <span class="op">=</span> <span class="va">req_df</span><span class="op">[</span><span class="va">req_df</span><span class="op">$</span><span class="va">format</span> <span class="op">==</span> <span class="st">"ARC/INFO ASCII GRID"</span> <span class="op">&amp;</span>
                    <span class="va">req_df</span><span class="op">$</span><span class="va">product</span> <span class="op">==</span> <span class="st">"DTM"</span> <span class="op">&amp;</span>
                    <span class="va">req_df</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2019</span>, <span class="op">]</span>
<span class="va">req_df_DSM</span> <span class="op">=</span> <span class="va">req_df</span><span class="op">[</span><span class="va">req_df</span><span class="op">$</span><span class="va">format</span> <span class="op">==</span> <span class="st">"ARC/INFO ASCII GRID"</span> <span class="op">&amp;</span>
                    <span class="va">req_df</span><span class="op">$</span><span class="va">product</span> <span class="op">==</span> <span class="st">"DSM"</span> <span class="op">&amp;</span>
                    <span class="va">req_df</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2019</span>, <span class="op">]</span>

<span class="co"># combine data tables</span>
<span class="va">req_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">req_df_DTM</span>, <span class="va">req_df_DSM</span><span class="op">)</span>
<span class="va">req_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>##             sheetID year              format resolution avgElevErr
## 30 N-33-130-D-b-1-1 2019 ARC/INFO ASCII GRID      1.0 m        0.1
## 29 N-33-130-D-b-1-1 2019 ARC/INFO ASCII GRID      0.5 m        0.1</code></pre>
<p>Now we can download the data using the <code><a href="../reference/tile_download.html">tile_download()</a></code> function with our filtered data frame as input.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 168.7 MB</span>
<span class="fu"><a href="../reference/tile_download.html">tile_download</a></span><span class="op">(</span><span class="va">req_df</span>, outdir <span class="op">=</span> <span class="st">"./data"</span><span class="op">)</span></code></pre></div>
<pre><code>## 1/2
## 2/2</code></pre>
</div>
<div id="processing" class="section level3">
<h3 class="hasAnchor">
<a href="#processing" class="anchor"></a>Processing</h3>
<p>Let’s load the downloaded numerical models using the <code><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars()</a></code> function from the <strong>stars</strong> package, which allows working on spatiotemporal arrays. We have two files, one represents DTM and second represents DSM.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load data</span>
<span class="va">DTM</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="st">"data/73044_917579_N-33-130-D-b-1-1.asc"</span>, proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">DSM</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/read_stars.html">read_stars</a></span><span class="op">(</span><span class="st">"data/73043_917495_N-33-130-D-b-1-1.asc"</span>, proxy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># name raster</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">DTM</span><span class="op">)</span> <span class="op">=</span> <span class="st">"DTM"</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">DSM</span><span class="op">)</span> <span class="op">=</span> <span class="st">"DSM"</span>

<span class="co"># set coordinate system</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">DTM</span><span class="op">)</span> <span class="op">=</span> <span class="fl">2180</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">DSM</span><span class="op">)</span> <span class="op">=</span> <span class="fl">2180</span></code></pre></div>
<p>You probably noticed the four-fold difference in their sizes. It is due to the difference between their cells resolutions. We need to unify them to a common resolution to be able to combine them into one stack. It is much better to use a lower resolution than to increase it, because we cannot get more information and the processing will be faster. Let’s use the <code><a href="https://r-spatial.github.io/stars/reference/st_warp.html">st_warp()</a></code> function to do this.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DSM</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_warp.html">st_warp</a></span><span class="op">(</span><span class="va">DSM</span>, dest <span class="op">=</span> <span class="va">DTM</span>, cellsize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Now, both models have the same dimensions (the number of rows and columns) and spatial resolution. Thus, we can combine them into one object (<code>DEM</code>).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DEM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">DTM</span>, <span class="va">DSM</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">DEM</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>Now we have a DEM object that consists of two attributes (DTM and DSM). In fact, both attributes contains same type of data as they are representing elevation. Therefore, we can collapse the attributes into a new dimension. Let’s do that using <code><a href="https://r-spatial.github.io/stars/reference/redimension.html">st_redimension()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DEM</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/redimension.html">st_redimension</a></span><span class="op">(</span><span class="va">DEM</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span><span class="va">DEM</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">"elev"</span> <span class="co"># name new data dim</span>
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html">st_dimensions</a></span><span class="op">(</span><span class="va">DEM</span><span class="op">)</span></code></pre></div>
<pre><code>##      from   to offset delta               refsys point   values x/y
## x       1 2188 355733     1 ETRS89 / Poland CS92  TRUE     NULL [x]
## y       1 2379 517029    -1 ETRS89 / Poland CS92  TRUE     NULL [y]
## elev    1    2     NA    NA                   NA    NA DTM, DSM</code></pre>
<p>After this operation, our elevation attribute consists of the DTM and DSM layers (dimensions). Then let’s crop the rasters to our buffer.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DEM</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span><span class="va">DEM</span>, <span class="va">morasko_buffer</span><span class="op">)</span></code></pre></div>
<p>Let’s check what the result looks like.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">DEM</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">99</span>, alpha <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DEM-PLOT-1.png"></p>
<p>In the first quadrant of the circle, we can see five smaller circles. These are the craters formed after the impact of the Morasko meteorite. The largest fragment found weighs 272 kg and it is the largest meteorite found in Poland. The collection of found meteorites can be seen at the <a href="http://muzeumziemi.amu.edu.pl/">Earth Museum</a> in Poznań.</p>
<p>Let’s calculate the crater width using the terrain transverse profile. We can use our centroid and add a second example point 30 degrees towards N. Next, we connect these points into a line (<code><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring()</a></code>) and then sample this line every 1 m (<code><a href="https://r-spatial.github.io/sf/reference/st_line_sample.html">st_line_sample()</a></code>), because our DEM has this resolution. As a result, we get one complex geometry (<em>MULTIPOINT</em>), which we have to convert into a simple geometry (<em>POINT</em>) consisting of many points. The function <code><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast()</a></code> is used for this.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pts_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">357121.7</span>, <span class="fl">515765.5</span>,
                      <span class="fl">357321.2</span>, <span class="fl">516017.9</span><span class="op">)</span>,
                    ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">line</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="va">pts_matrix</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">2180</span><span class="op">)</span>
<span class="va">line</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_line_sample.html">st_line_sample</a></span><span class="op">(</span><span class="va">line</span>, density <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">line</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="va">line</span>, <span class="st">"POINT"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot DTM (first layer)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">DEM</span><span class="op">[</span>, , , <span class="fl">1</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"DTM [m]"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">99</span>, alpha <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
     reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">line</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="DEM-LINE-1.png"></p>
<p>In the last step, we extract the elevation values for these points using <code><a href="https://r-spatial.github.io/stars/reference/st_extract.html">st_extract()</a></code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># take elevation from DTM and DSM layers</span>
<span class="va">elev_line</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_extract.html">st_extract</a></span><span class="op">(</span><span class="va">DEM</span>, <span class="va">line</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">elev_line</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DTM"</span>, <span class="st">"DSM"</span><span class="op">)</span></code></pre></div>
<p>Now we can see how our transverse profile looks like.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use 'dev.off()' to reset previous plot</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">elev_line</span><span class="op">[</span>, <span class="st">"DTM"</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, main <span class="op">=</span> <span class="st">"Digital terrain model"</span>,
     ylab <span class="op">=</span> <span class="st">"Elevation [m]"</span>, xlab <span class="op">=</span> <span class="st">"Distance [m]"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">126</span>, <span class="fl">219</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="DEM-PROFILE-1.png"></p>
<p>The largest width of the impact crater is about 90 m.</p>
<p>Okay, we checked the terrain. In the last step, let’s examine the height of the objects on it. For this purpose, we calculate the height of the trees by subtracting the DTM from the DSM. The product of this difference is called normalized DSM, because it takes the terrain elevation as a reference.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calc</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">DEM</span><span class="op">)</span> <span class="op">(</span><span class="va">DEM</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">DEM</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">nDSM</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">DEM</span>, MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">calc</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">nDSM</span>, main <span class="op">=</span> <span class="st">"Trees height [m]"</span>,
     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">9</span>, palette <span class="op">=</span> <span class="st">"Greens"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="DEM-TREES-1.png"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Krzysztof Dyba, Jakub Nowosad.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
