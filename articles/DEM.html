<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digital Elevation Model • rgugik</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Digital Elevation Model">
<meta property="og:description" content="rgugik">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rgugik</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/orthophotomap.html">Orthophotomap</a>
    </li>
    <li>
      <a href="../articles/DEM.html">Digital Elevation Model</a>
    </li>
    <li>
      <a href="../articles/articles/geodb_description.html">General Geographic Database</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kadyb/rgugik/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="DEM_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Digital Elevation Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kadyb/rgugik/blob/master/vignettes/DEM.Rmd"><code>vignettes/DEM.Rmd</code></a></small>
      <div class="hidden name"><code>DEM.Rmd</code></div>

    </div>

    
    
<style>
body {text-align: justify}
</style>
<div id="definition" class="section level2">
<h2 class="hasAnchor">
<a href="#definition" class="anchor"></a>Definition</h2>
<p><strong>Digital Elevation Models</strong> are models that describe the terrain surface. They are created as a result of the processing of aerial photos, laser scanning (LiDAR), geodetic surveying or radar interferometry (InSAR). DEMs are one of the key datasets in Geographic Information Systems (GIS) and constitute the basis for environmental spatial analyses. In addition, they are a source for derived products such as terrain slope and exposure. DEM is the general name for a group of models with different characteristics, including:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Digital Terrain Model</strong> (DTM) - numerical representation of the terrain with its morphological forms. This model is devoid of any objects above the ground, such as buildings or trees.</li>
<li>
<strong>Digital Surface Model</strong> (DSM) - numerical representation of the terrain, including objects on its surface, such as buildings and trees.</li>
</ol>
<center>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/DTM_DSM.svg/1024px-DTM_DSM.svg.png" title="fig:" style="width:50.0%" alt="DTM-DSM">
</center>
<p>The properties of the DEMs:</p>
<ol style="list-style-type: decimal">
<li>Format - we can distinguish three structures: <strong>GRID</strong> (point / cell), <strong>TIN</strong> (irregular topological triangle network) and <strong>contour lines</strong> (vector). Currently, the most used format is GRID.</li>
<li>Accuracy - is related to the vertical measurement error.</li>
<li>Spatial resolution - is related to the size of the smallest object that can be detected by the sensor and is determined by the size of the image cell (pixel). The larger the cell, the more generalized form of the terrain it presents.</li>
</ol>
</div>
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>The purpose of this exercise is to determine the elevation of the ground surface and objects in the selected area. The source of the data will be Airborne Laser Scanning already processed to GRID format.</p>
</div>
<div id="analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis" class="anchor"></a>Analysis</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://r-spatial.github.io/sf">"sf"</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://r-spatial.github.io/stars">"stars"</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="https://kadyb.github.io/rgugik">"rgugik"</a></span>)
</pre></div>
<p>Our analysis area will be the Morasko Meteorite nature reserve located in the Greater Poland voivodeship. It was established in 1976 in order to protect the area of impact craters, which, according to researchers, were formed in the fall of the Morasko meteorite about 5,000 years ago. In addition, the oak-hornbeam forest with rare species of plants (<em>lilium martagon</em>, <em>ceratophyllum submersum</em>) and birds (<em>european nightjar</em>, <em>black woodpecker</em>) are protected.</p>
<div id="vector-data" class="section level3">
<h3 class="hasAnchor">
<a href="#vector-data" class="anchor"></a>Vector data</h3>
<p>The centroid (geometric center) of the Morasko Meteorite nature reserve has X = 16.895 and Y = 52.487 coordinates in World Geodetic System 1984 (EPSG 4326). Let’s create this point with the <strong>sf</strong> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">morasko</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">16.895</span>, <span class="fl">52.489</span>))
<span class="kw">morasko</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(<span class="kw">morasko</span>, crs = <span class="fl">4326</span>) <span class="co"># set coordinate system</span>
<span class="kw">morasko</span>
</pre></div>
<pre><code>## Geometry set for 1 feature 
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 16.895 ymin: 52.489 xmax: 16.895 ymax: 52.489
## geographic CRS: WGS 84</code></pre>
<pre><code>## POINT (16.895 52.489)</code></pre>
<p>Now we have our point which is embedded in space (has a spatial reference). In the next step, let’s create an approximate zone that will include the area of the reserve. The function <code>st_buffer</code> will be used for this. Before this operation, we need to transform the coordinate system to a system with metric units, e.g. Poland CS92 (EPSG 2180), using <code>st_transform</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">morasko</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="kw">morasko</span>, crs = <span class="fl">2180</span>)
<span class="kw">morasko_buffer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_unary.html">st_buffer</a></span>(<span class="kw">morasko</span>, dist = <span class="fl">400</span>)
</pre></div>
<p>We have created a buffer with a radius of 400 meters. Then we can visualize it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">morasko_buffer</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">morasko</span>, add = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="DEM-GEOMETRY-1.png"></p>
<p>Of course, the area shown is not exactly a reserve area. The exact area can be determined from the polygon layer as in <a href="https://kadyb.github.io/rgugik/articles/orthophotomap.html">orthophotomap</a> example using General Geographic Database.</p>
</div>
<div id="raster-data" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-data" class="anchor"></a>Raster data</h3>
<p>Now we will search for available elevation data for this area using the <code>DEM_request</code> function (it is analogous to the <code>orto_request</code> function). The argument of the function is our buffer with reserve. Note, <code>DEM_request</code> takes data frame as input, and currently the morasko_buffer object is a list, so we need to convert it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">morasko_buffer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sf.html">st_sf</a></span>(<span class="kw">morasko_buffer</span>) <span class="co"># set as data frame</span>
<span class="kw">req_df</span> <span class="op">=</span> <span class="fu"><a href="../reference/DEM_request.html">DEM_request</a></span>(<span class="kw">morasko_buffer</span>)
</pre></div>
<p>Let’s check the obtained results.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># display the first 10 rows and the first 5 columns</span>
<span class="kw">req_df</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
</pre></div>
<pre><code>##                 sheetID year              format resolution avgElevErr
## 1        N-33-130-D-b-1 2011           ASCII TBD     25.0 m        0.9
## 2      N-33-130-D-b-1-1 2012      ASCII XYZ GRID      0.5 m        0.1
## 3      N-33-130-D-b-1-1 2012 ARC/INFO ASCII GRID      0.5 m        0.1
## 4      N-33-130-D-b-1-1 2012      ASCII XYZ GRID      1.0 m        0.1
## 5      N-33-130-D-b-1-1 2012 ARC/INFO ASCII GRID      1.0 m        0.1
## 6  N-33-130-D-b-1-1-1-4 2012                 LAS    12 p/m2        0.1
## 7  N-33-130-D-b-1-1-2-3 2012                 LAS    12 p/m2        0.1
## 8  N-33-130-D-b-1-1-2-4 2012                 LAS    12 p/m2        0.1
## 9  N-33-130-D-b-1-1-3-2 2012                 LAS    12 p/m2        0.1
## 10 N-33-130-D-b-1-1-4-1 2012                 LAS    12 p/m2        0.1</code></pre>
<p>We have received many types of data with different formats, timeliness, resolution and accuracy. We need Digital Terrain Model and Digital Surface Model in “ARC/INFO ASCII GRID” format for our analysis. Let’s make data selection by creating two tables and combining them at the end.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">req_df_DTM</span> <span class="op">=</span> <span class="kw">req_df</span>[<span class="kw">req_df</span><span class="op">$</span><span class="kw">format</span> <span class="op">==</span> <span class="st">"ARC/INFO ASCII GRID"</span> <span class="op">&amp;</span>
                    <span class="kw">req_df</span><span class="op">$</span><span class="kw">product</span> <span class="op">==</span> <span class="st">"DTM"</span> <span class="op">&amp;</span>
                    <span class="kw">req_df</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="fl">2019</span>, ]
<span class="kw">req_df_DSM</span> <span class="op">=</span> <span class="kw">req_df</span>[<span class="kw">req_df</span><span class="op">$</span><span class="kw">format</span> <span class="op">==</span> <span class="st">"ARC/INFO ASCII GRID"</span> <span class="op">&amp;</span>
                    <span class="kw">req_df</span><span class="op">$</span><span class="kw">product</span> <span class="op">==</span> <span class="st">"DSM"</span> <span class="op">&amp;</span>
                    <span class="kw">req_df</span><span class="op">$</span><span class="kw">year</span> <span class="op">==</span> <span class="fl">2019</span>, ]

<span class="co"># combine data tables</span>
<span class="kw">req_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw">req_df_DTM</span>, <span class="kw">req_df_DSM</span>)
<span class="kw">req_df</span>[, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
</pre></div>
<pre><code>##             sheetID year              format resolution avgElevErr
## 30 N-33-130-D-b-1-1 2019 ARC/INFO ASCII GRID      1.0 m        0.1
## 29 N-33-130-D-b-1-1 2019 ARC/INFO ASCII GRID      0.5 m        0.1</code></pre>
<p>Now we can download the data using the <code>tile_download</code> function with our filtered data frame as input.</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="co"># 168.7 MB</span>
<span class="fu"><a href="../reference/tile_download.html">tile_download</a></span>(<span class="kw">req_df</span>, outdir = <span class="st">"./data"</span>)
</pre></div>
</div>
<div id="processing" class="section level3">
<h3 class="hasAnchor">
<a href="#processing" class="anchor"></a>Processing</h3>
<p>Let’s load the downloaded numerical models using the <code><a href="https://rdrr.io/pkg/stars/man/read_stars.html">read_stars()</a></code> function from the <strong>stars</strong> package, which allows to work on spatiotemporal arrays. We have two files, one represents DTM and second represents DSM.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="co"># load data</span>
<span class="kw">DTM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stars/man/read_stars.html">read_stars</a></span>(<span class="st">"data/73044_917579_N-33-130-D-b-1-1.asc"</span>, proxy = <span class="fl">FALSE</span>)
<span class="kw">DSM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stars/man/read_stars.html">read_stars</a></span>(<span class="st">"data/73043_917495_N-33-130-D-b-1-1.asc"</span>, proxy = <span class="fl">FALSE</span>)

<span class="co"># name raster</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span>(<span class="kw">DTM</span>) <span class="op">=</span> <span class="st">"DTM"</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span>(<span class="kw">DSM</span>) <span class="op">=</span> <span class="st">"DSM"</span>

<span class="co"># set coordinate system</span>
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="kw">DTM</span>) <span class="op">=</span> <span class="fl">2180</span>
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="kw">DSM</span>) <span class="op">=</span> <span class="fl">2180</span>
</pre></div>
<p>You probably noticed the fourfold difference in their size. It results from twice the cells resolution between these models. We need to reduce them to a common resolution to be able to combine them into one stack. It is much better to lower resolution than to increase it because we cannot get more information and the processing will be faster. Let’s use the <code>st_warp</code> function to do this.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">DSM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stars/man/st_warp.html">st_warp</a></span>(<span class="kw">DSM</span>, dest = <span class="kw">DTM</span>, cellsize = <span class="fl">1</span>)
</pre></div>
<p>We will now combine our models into one stack. The matrix cells will contain exactly the same objects.</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">DEM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">DTM</span>, <span class="kw">DSM</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">DEM</span>)
</pre></div>
<pre><code>## [1] 2</code></pre>
<p>We got a DEM object that consists of two attributes (DTM and DSM). In fact, this is exactly one attribute related to elevation (same type of data). For example, another attribute can be a spectral reflection. Therefore, we should change the attribute to the dimension. Let’s do that using <code>st_redimension</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">DEM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stars/man/redimension.html">st_redimension</a></span>(<span class="kw">DEM</span>)
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/stars/man/st_dimensions.html">st_dimensions</a></span>(<span class="kw">DEM</span>))[<span class="fl">3</span>] <span class="op">=</span> <span class="st">"elev"</span> <span class="co"># name new data dim</span>
<span class="fu"><a href="https://rdrr.io/pkg/stars/man/st_dimensions.html">st_dimensions</a></span>(<span class="kw">DEM</span>)
</pre></div>
<pre><code>##      from   to offset delta               refsys point   values    
## x       1 2188 355733     1 ETRS89 / Poland CS92  TRUE     NULL [x]
## y       1 2379 517029    -1 ETRS89 / Poland CS92  TRUE     NULL [y]
## elev    1    2     NA    NA                   NA    NA DTM, DSM</code></pre>
<p>After this operation, our elevation attribute consists of the DTM and DSM layers (dimensions). Then let’s cut the rasters to our buffer.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">DEM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crop.html">st_crop</a></span>(<span class="kw">DEM</span>, <span class="kw">morasko_buffer</span>)
</pre></div>
<p>Let’s check what the visualization looks like.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">DEM</span>, col = <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span>(<span class="fl">99</span>, alpha = <span class="kw">NULL</span>))
</pre></div>
<p><img src="DEM-PLOT-1.png"></p>
<p>In the first quadrant of the circle we can see 5 smaller circles. These are the craters formed after the impact of the Morasko meteorite. The largest found fragment weighs 272 kg and it is the largest meteorite found in Poland. The collection of found meteorites can be seen at the <a href="http://muzeumziemi.amu.edu.pl/">Earth Museum</a> in Poznań.</p>
<p>Let’s calculate the crater width using the terrain transverse profile. We will use our centroid and the second example point towards 30 degrees N. Next, we will connect these points into a line (<code><a href="https://rdrr.io/pkg/sf/man/st.html">st_linestring()</a></code>) and then sample this line every 1 m (<code><a href="https://rdrr.io/pkg/sf/man/st_line_sample.html">st_line_sample()</a></code>), because our DEM has this resolution. As a result, we will get one complicated geometry (<em>MULTIPOINT</em>), which we have to convert into simple geometry (<em>POINT</em>) consisting of many points. The function <code><a href="https://rdrr.io/pkg/sf/man/st_cast.html">st_cast()</a></code> is used for this. In the last step, we extract the elevation values for these points using <code><a href="https://rdrr.io/pkg/stars/man/st_extract.html">st_extract()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="kw">pts_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">357121.7</span>, <span class="fl">515765.5</span>,
                      <span class="fl">357321.2</span>, <span class="fl">516017.9</span>),
                    ncol = <span class="fl">2</span>, byrow = <span class="fl">TRUE</span>)
<span class="kw">line</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_linestring</a></span>(<span class="kw">pts_matrix</span>), crs = <span class="fl">2180</span>)
<span class="kw">line</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_line_sample.html">st_line_sample</a></span>(<span class="kw">line</span>, density = <span class="fl">1</span>)
<span class="kw">line</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_cast.html">st_cast</a></span>(<span class="kw">line</span>, <span class="st">"POINT"</span>)
<span class="co"># take attribute with DTM and DSM layers</span>
<span class="kw">elev_line</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stars/man/st_extract.html">st_extract</a></span>(<span class="kw">DEM</span>, <span class="kw">line</span>)[[<span class="fl">1</span>]]
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="kw">elev_line</span>) <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"DTM"</span>, <span class="st">"DSM"</span>)
</pre></div>
<p>Now we can see what our transverse profile looks like.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">elev_line</span>[, <span class="st">"DTM"</span>], type = <span class="st">"l"</span>, main = <span class="st">"Digital Terrain Model"</span>,
     ylab = <span class="st">"Elevation [m]"</span>, xlab = <span class="st">"Distance [m]"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(v = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">126</span>, <span class="fl">219</span>), col = <span class="st">"blue"</span>)
</pre></div>
<p><img src="DEM-PROFILE-1.png"></p>
<p>The largest width of the impact crater is about 90 m.</p>
<p>Okay, we checked the terrain. In the last step, let’s examine the height of the objects on it. We will calculate the height of the trees by subtracting the DTM from the DSM. The product of this difference is called normalized DSM, because it takes the terrain elevation as a reference.</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">calc</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">DEM</span>) (<span class="kw">DEM</span>[<span class="fl">2</span>] <span class="op">-</span> <span class="kw">DEM</span>[<span class="fl">1</span>])
<span class="kw">nDSM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/stars/man/st_apply.html">st_apply</a></span>(<span class="kw">DEM</span>, MARGIN = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>), FUN = <span class="kw">calc</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">nDSM</span>, main = <span class="st">"Trees height [m]"</span>)
</pre></div>
<p><img src="DEM-TREES-1.png"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Krzysztof Dyba, Jakub Nowosad.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
