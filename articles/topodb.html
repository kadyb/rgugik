<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Topographic Database • rgugik</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Topographic Database">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rgugik</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/orthophotomap.html">Orthophotomap</a></li>
    <li><a class="dropdown-item" href="../articles/DEM.html">Digital Elevation Model</a></li>
    <li><a class="dropdown-item" href="../articles/topodb.html">Topographic Database</a></li>
    <li><a class="dropdown-item" href="../articles/articles/spatialdb_description.html">Spatial Databases</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kadyb/rgugik/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Topographic Database</h1>
                        <h4 data-toc-skip class="author">Krzysztof Dyba,
Jakub Nowosad</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kadyb/rgugik/blob/master/vignettes/topodb.Rmd" class="external-link"><code>vignettes/topodb.Rmd</code></a></small>
      <div class="d-none name"><code>topodb.Rmd</code></div>
    </div>

    
    
<style>
body {text-align: justify}
</style>
<div class="section level2">
<h2 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h2>
<p><strong>Topographic Database</strong> (pl. <em>Baza Danych Obiektów
Topograficznych</em>) is a vector (object) database containing the
spatial location of topographic objects with their characteristics for
Poland. The content and detail of the database correspond to the
topographic map in the scale 1:10000. The thematic scope includes
information on water network, communication network, land cover,
buildings and technical structures, utility infrastructure, land use,
protected areas, territorial division units, and other objects. The
database is available in the Geography Markup Language (GML) format. The
source of its data comes from:</p>
<ul>
<li>other spatial databases maintained by Polish Head Office of Geodesy
and Cartography (e.g. <em>Register of Towns, Streets and Addresses</em>,
<em>Register of Land and Buildings</em>, <em>State Register of
Borders</em>),</li>
<li>databases maintained by other ministries or institutions (e.g.,
Ministry of Infrastructure, State Water Management, General Directorate
for Environmental Protection),</li>
<li>fieldworks.</li>
</ul>
</div>
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>The purpose of this vignette is to perform spatial operations on
vector data from the Topographic Database. We focus on four cases,
taking into account different types of geometry, i.e. point, line, and
polygon, and their attributes. Also, we show how they can be
visualized.</p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># attach packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kadyb.github.io/rgugik/">rgugik</a></span><span class="op">)</span></span></code></pre></div>
<p>Our analysis area is the <em>bieszczadzki</em> county located in the
Subcarpathian (<em>podkarpackie</em>) voivodeship. It is the farthest
south area in Poland that also has the lowest population density (19
people on km<sup>2</sup>).</p>
<div class="section level3">
<h3 id="database">Database<a class="anchor" aria-label="anchor" href="#database"></a>
</h3>
<p>We start by downloading the topographic database for our county using
the <code><a href="../reference/topodb_download.html">topodb_download()</a></code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 22.4 MB</span></span>
<span><span class="fu"><a href="../reference/topodb_download.html">topodb_download</a></span><span class="op">(</span><span class="st">"bieszczadzki"</span>, outdir <span class="op">=</span> <span class="st">"./data"</span><span class="op">)</span></span></code></pre></div>
<p>If you run into any problem with the download, remember that you can
pass another download method from <code><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file()</a></code> as a
function argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/topodb_download.html">topodb_download</a></span><span class="op">(</span><span class="va">req_df</span>, outdir <span class="op">=</span> <span class="st">"./data"</span>, method <span class="op">=</span> <span class="st">"wget"</span><span class="op">)</span></span></code></pre></div>
<p>The downloaded database consists of many files in the <em>GML</em>
format. All the data necessary for analyzes can be found in the
<code>data/PL.PZGiK.332.1801/BDOT10k/</code> location. A brief
description of the structure of this database can be found <a href="https://kadyb.github.io/rgugik/articles/articles/spatialdb_description.html">here</a>.</p>
<p>First, let’s load the file with administrative units
(“PL.PZGiK.332.1801__OT_ADJA_A.xml”) using the <strong>sf</strong>
package and its <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">territory</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"data/PL.PZGiK.332.1801/BDOT10k/PL.PZGiK.332.1801__OT_ADJA_A.xml"</span><span class="op">)</span></span></code></pre></div>
<p>The file contains administrative units at various levels, let’s
choose the lowest level, i.e. communes. There are three types of
communes in this dataset, specified in the <code>rodzaj</code> column:
urban (<em>GM</em>), rural (<em>GW</em>), and urban-rural
(<em>Gmw</em>). Let’s select them.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">communes</span> <span class="op">=</span> <span class="va">territory</span><span class="op">[</span><span class="va">territory</span><span class="op">$</span><span class="va">rodzaj</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GM"</span>, <span class="st">"GW"</span>, <span class="st">"Gmw"</span><span class="op">)</span>, <span class="st">"rodzaj"</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">communes</span><span class="op">$</span><span class="va">rodzaj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Gmw  GW </span></span>
<span><span class="co">##   1   2</span></span></code></pre>
<p>We can see that the <em>bieszczadzki</em> county consists of two
rural communes and one urban-rural commune. Let’s visualize it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">communes</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">"Bieszczadzki county"</span><span class="op">)</span></span></code></pre></div>
<p><img src="topodb-communes-1.png"></p>
</div>
<div class="section level3">
<h3 id="lengths-and-categories-of-roads">Lengths and categories of roads<a class="anchor" aria-label="anchor" href="#lengths-and-categories-of-roads"></a>
</h3>
<p>In the first task, we calculate the lengths of roads, taking into
account their categories. Road data can be found in the
“PL.PZGiK.332.1801__OT_SKDR_L.xml” file.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roads</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"data/PL.PZGiK.332.1801/BDOT10k/PL.PZGiK.332.1801__OT_SKDR_L.xml"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot them. We use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function again, but
this time we combine the two layers into one image. The first layer (in
the background) contains roads and to add another layer, we have to set
the argument <code>reset</code> to <code>"FALSE"</code>. Then we can add
a second layer with the territory borders by setting the
<code>add</code> argument to <code>"TRUE"</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">roads</span><span class="op">[</span><span class="st">"katZarzadzania"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Road category"</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">territory</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="topodb-roads-1.png"></p>
<p>We have six road categories related to the managing entity. Those
are: national (K), voivodeship (W), county (P), communal (G),
institutional (Z), and other (I) roads.</p>
<p>We use the <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length()</a></code> function to find the length of
each object in the table. Next, we create a data frame consisting of the
road category and its length. Then we aggregate this data frame and
calculate the sum of the lengths for each category.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length_roads</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length</a></span><span class="op">(</span><span class="va">roads</span><span class="op">)</span></span>
<span><span class="va">length_roads</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>length <span class="op">=</span> <span class="va">length_roads</span>,</span>
<span>                          class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">roads</span><span class="op">$</span><span class="va">katZarzadzania</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">length_roads</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">length</span> <span class="op">~</span> <span class="va">class</span>, data <span class="op">=</span> <span class="va">length_roads</span>, FUN <span class="op">=</span> <span class="va">sum</span><span class="op">)</span></span></code></pre></div>
<p>The results are given in meters - let’s convert them into
kilometers.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert to [km]</span></span>
<span><span class="va">length_roads</span><span class="op">$</span><span class="va">length</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">length_roads</span><span class="op">$</span><span class="va">length</span>, <span class="st">"km"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s also change the names of the categories.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">road_class</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"communal"</span>, <span class="st">"other"</span>, <span class="st">"national"</span>, <span class="st">"county"</span>, <span class="st">"voivodeship"</span>,</span>
<span>               <span class="st">"institutional"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">length_roads</span><span class="op">$</span><span class="va">class</span><span class="op">)</span> <span class="op">=</span> <span class="va">road_class</span></span></code></pre></div>
<p>Now we can see the results. The <code>other</code> type of roads
dominates that consists mainly of non-public roads.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length_roads</span></span></code></pre></div>
<pre><code><span><span class="co">##           class          length</span></span>
<span><span class="co">## 1      communal  186.17329 [km]</span></span>
<span><span class="co">## 2         other 2819.55806 [km]</span></span>
<span><span class="co">## 3      national   19.24996 [km]</span></span>
<span><span class="co">## 4        county  187.17870 [km]</span></span>
<span><span class="co">## 5   voivodeship  105.67567 [km]</span></span>
<span><span class="co">## 6 institutional   10.44893 [km]</span></span></code></pre>
<p>We can also calculate the total length of the roads in this area.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">length_roads</span><span class="op">$</span><span class="va">length</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 3328.285 [km]</span></span></code></pre>
<p>The result is about 3328.285 km. Another aspect of the data that we
can investigate is the density of the road network. We need to calculate
the total area first, and then divide the total road length by the total
area.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">communes_area</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">communes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">communes_area</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">communes_area</span>, <span class="st">"km2"</span><span class="op">)</span></span>
<span><span class="va">density</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">length_roads</span><span class="op">$</span><span class="va">length</span><span class="op">)</span><span class="op">/</span><span class="va">communes_area</span></span>
<span><span class="va">density</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">density</span>, <span class="st">"km/km2"</span><span class="op">)</span></span>
<span><span class="va">density</span></span></code></pre></div>
<pre><code><span><span class="co">## 2.921031 [km/km2]</span></span></code></pre>
<p>The road density is about 2.92 km/km<sup>2</sup>.</p>
</div>
<div class="section level3">
<h3 id="roads-through-the-rivers">Roads through the rivers<a class="anchor" aria-label="anchor" href="#roads-through-the-rivers"></a>
</h3>
<p>Another dataset included in the Topographic Database contains rivers
for this area (“PL.PZGiK.332.1801__OT_SWRS_L.xml”).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rivers</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"data/PL.PZGiK.332.1801/BDOT10k/PL.PZGiK.332.1801__OT_SWRS_L.xml"</span><span class="op">)</span></span>
<span><span class="va">rivers</span> <span class="op">=</span> <span class="va">rivers</span><span class="op">[</span><span class="va">rivers</span><span class="op">$</span><span class="va">rodzaj</span> <span class="op">==</span> <span class="st">"Rz"</span>, <span class="op">]</span> <span class="co"># select only rivers</span></span></code></pre></div>
<p>Rivers are divided into smaller sections with different parameters,
such as river width or data source. Let’s merge sections from the same
rivers into a single feature (geometry) - we can use the attribute with
an ID (<code>idMPHP</code>) for that purpose. We can also give each
river a category number by creating a sequence from 1 to n using the
<code>seq_len</code> function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rivers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">rivers</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geometry"</span>, <span class="st">"idMPHP"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">rivers</span><span class="op">$</span><span class="va">idMPHP</span><span class="op">)</span>,</span>
<span>                   <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">rivers</span><span class="op">$</span><span class="va">idMPHP</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">rivers</span><span class="op">$</span><span class="va">idMPHP</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rivers</span><span class="op">$</span><span class="va">idMPHP</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">rivers</span><span class="op">$</span><span class="va">idMPHP</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualize the rivers’ courses.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rivers</span><span class="op">[</span><span class="st">"idMPHP"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Rivers"</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">territory</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="topodb-rivers-1.png"></p>
<p>With rivers and roads, we can designate points of intersection that
symbolize bridges and crossings. We can use the
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection()</a></code> function for this.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bridges</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">rivers</span>, <span class="va">roads</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bridges</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 81</span></span></code></pre>
<p>We get 81 such points. Let’s plot them.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use 'dev.off()' to reset previous plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">rivers</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Bridges and crossings"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">territory</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bridges</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="topodb-bridges-1.png"></p>
</div>
<div class="section level3">
<h3 id="land-cover">Land cover<a class="anchor" aria-label="anchor" href="#land-cover"></a>
</h3>
<p>Land cover is the physical material at the surface of the earth like
grass, trees, bare ground, water, etc. Let’s check the land cover data
for our county - it is stored in files with the <code>PT</code> prefix.
We use the <code><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files()</a></code> function to list them. The
<code>pattern</code> argument is important here because it determines
what files should be selected. Our <code>pattern</code> should look like
this: <code>PT+.+A\\.xml$</code> - only files containing areal data (A)
of land cover (PT) will be listed.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/PL.PZGiK.332.1801/BDOT10k"</span>,</span>
<span>                   pattern <span class="op">=</span> <span class="st">"PT+.+A\\.xml$"</span>,</span>
<span>                   full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print filenames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "PL.PZGiK.332.1801__OT_PTGN_A.xml"</span></span>
<span><span class="co">##  [2] "PL.PZGiK.332.1801__OT_PTKM_A.xml"</span></span>
<span><span class="co">##  [3] "PL.PZGiK.332.1801__OT_PTLZ_A.xml"</span></span>
<span><span class="co">##  [4] "PL.PZGiK.332.1801__OT_PTNZ_A.xml"</span></span>
<span><span class="co">##  [5] "PL.PZGiK.332.1801__OT_PTPL_A.xml"</span></span>
<span><span class="co">##  [6] "PL.PZGiK.332.1801__OT_PTRK_A.xml"</span></span>
<span><span class="co">##  [7] "PL.PZGiK.332.1801__OT_PTSO_A.xml"</span></span>
<span><span class="co">##  [8] "PL.PZGiK.332.1801__OT_PTTR_A.xml"</span></span>
<span><span class="co">##  [9] "PL.PZGiK.332.1801__OT_PTUT_A.xml"</span></span>
<span><span class="co">## [10] "PL.PZGiK.332.1801__OT_PTWP_A.xml"</span></span>
<span><span class="co">## [11] "PL.PZGiK.332.1801__OT_PTWZ_A.xml"</span></span>
<span><span class="co">## [12] "PL.PZGiK.332.1801__OT_PTZB_A.xml"</span></span></code></pre>
<p>We also can exclude “PL.PZGiK.332.1801__OT_PTSO_A.xml” file from the
list, because this file contains zero objects (features).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># drop "OT_PTSO_A.xml"</span></span>
<span><span class="va">files</span> <span class="op">=</span> <span class="va">files</span><span class="op">[</span><span class="op">-</span><span class="fl">7</span><span class="op">]</span></span></code></pre></div>
<p>Let’s prepare the names of the objects to which the data will be
loaded. The following names are the extended names of the abbreviations
stored in the filenames.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layer_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fallowlands"</span>, <span class="st">"communication"</span>, <span class="st">"forest"</span>, <span class="st">"undeveloped"</span>,</span>
<span>                <span class="st">"squares"</span>, <span class="st">"shrublands"</span>, <span class="st">"crops"</span>, <span class="st">"grassland"</span>,</span>
<span>                <span class="st">"water"</span>, <span class="st">"heaps"</span>, <span class="st">"buildings"</span><span class="op">)</span></span></code></pre></div>
<p>Now we load each GML file, naming it from the list above. Instead of
using a loop, we can use the <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> function, which
performs a specific action for each element of the vector. The action in
our case is to load the GML files using <code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf()</a></code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">layers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">files</span>, <span class="va">read_sf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">layers</span><span class="op">)</span> <span class="op">=</span> <span class="va">layer_names</span></span></code></pre></div>
<p>Previously, we used <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length()</a></code> to calculate the line
length, now we use corresponding <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area()</a></code> function to
calculate the area. Here we use the <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> function
analogously, which will work for each item on the list. A similar
function is <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply()</a></code>, which returns a vector instead of a
list.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate areas in each layer</span></span>
<span><span class="va">area_landcover</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">layers</span>, <span class="va">st_area</span><span class="op">)</span></span>
<span><span class="co"># sum areas for each layer</span></span>
<span><span class="va">area_landcover</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">area_landcover</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="co"># convert units</span></span>
<span><span class="va">area_landcover</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">area_landcover</span>, <span class="st">"m^2"</span><span class="op">)</span></span>
<span><span class="va">area_landcover</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="va">area_landcover</span>, <span class="st">"km^2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">area_landcover</span><span class="op">)</span> <span class="op">=</span> <span class="va">layer_names</span></span></code></pre></div>
<p>Let’s see the results (in kilometers).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">area_landcover</span></span></code></pre></div>
<pre><code><span><span class="co">## Units: [km^2]</span></span>
<span><span class="co">##   fallowlands communication        forest   undeveloped       squares </span></span>
<span><span class="co">##    0.07561383    1.97014481  860.17248134    0.27817715    0.29038385 </span></span>
<span><span class="co">##    shrublands         crops     grassland         water         heaps </span></span>
<span><span class="co">##    1.57266555  255.13528884    0.63447491    8.81181550    0.09220115 </span></span>
<span><span class="co">##     buildings </span></span>
<span><span class="co">##   10.38781092</span></span></code></pre>
<p>Let’s make sure that the total land cover is equal to the area of our
county. Some tiny precision differences are possible, so we should set
the difference tolerance. This is possible using the
<code><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal()</a></code> function.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">area_landcover</span><span class="op">)</span>, <span class="va">communes_area</span>, tolerance <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>Everything is correct. Let’s present the results as percentages of
the area and sort them in descending order.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landcover_percentage</span> <span class="op">=</span> <span class="va">area_landcover</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">area_landcover</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/units.html" class="external-link">units</a></span><span class="op">(</span><span class="va">landcover_percentage</span><span class="op">)</span> <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># drop units</span></span>
<span><span class="va">landcover_percentage</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">landcover_percentage</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">landcover_percentage</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">landcover_percentage</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">landcover_percentage</span></span></code></pre></div>
<pre><code><span><span class="co">##        forest         crops     buildings         water communication </span></span>
<span><span class="co">##         75.49         22.39          0.91          0.77          0.17 </span></span>
<span><span class="co">##    shrublands     grassland       squares   undeveloped         heaps </span></span>
<span><span class="co">##          0.14          0.06          0.03          0.02          0.01 </span></span>
<span><span class="co">##   fallowlands </span></span>
<span><span class="co">##          0.01</span></span></code></pre>
<p>Over 75% of the county’s area is covered by forests and only less
than 1% by buildings.</p>
</div>
<div class="section level3">
<h3 id="buffer">Buffer<a class="anchor" aria-label="anchor" href="#buffer"></a>
</h3>
<p>In the last analysis in this vignette, we want to check how many
buildings have bus stops within a given distance. We can apply spatial
buffers to solve this question. Information about bus stops is in the
“PL.PZGiK.332.1801__OT_OIKM_P.xml” file, where they are represented by
the <em>OIKM04</em> value of the <code>x_kod</code> attribute.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bus_stop</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="st">"data/PL.PZGiK.332.1801/BDOT10k/PL.PZGiK.332.1801__OT_OIKM_P.xml"</span><span class="op">)</span></span>
<span><span class="va">bus_stop</span> <span class="op">=</span> <span class="va">bus_stop</span><span class="op">[</span><span class="va">bus_stop</span><span class="op">$</span><span class="va">x_kod</span> <span class="op">==</span> <span class="st">"OIKM04"</span>, <span class="op">]</span></span></code></pre></div>
<p>Let’s prepare a visualization in which the bus stops are marked with
blue dots and the buildings are presented as red polygons.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">=</span> <span class="va">layers</span><span class="op">$</span><span class="va">buildings</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">communes</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Bus stops"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">layers</span><span class="op">$</span><span class="va">buildings</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, border <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">bus_stop</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">0.7</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="topodb-busstops-1.png"></p>
<p>Let’s create a buffer for each bus stop with a range of 1 km using
<code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer()</a></code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bus_buffer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">bus_stop</span>, <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can plot it all.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">communes</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Bus stops buffers"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, border <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">bus_buffer</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="topodb-buffers-1.png"></p>
<p>To return the buildings within the buffer range, we can perform the
<code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_within()</a></code> operation.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings_buffer</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_within</a></span><span class="op">(</span><span class="va">buildings</span>, <span class="va">bus_buffer</span><span class="op">)</span></span></code></pre></div>
<p>The result is a nested list that consists of 2828 buildings and their
associated buffers. Let’s count how many buildings are not in any buffer
by using <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply()</a></code> as in the previous examples.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings_ex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">buildings_buffer</span>, <span class="va">length</span><span class="op">)</span></span>
<span><span class="va">buildings_ex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">buildings_ex</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">buildings_ex</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">buildings_ex</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">buildings_ex</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 14</span></span></code></pre>
<p>Answer to our last question: 14% of the buildings in this county do
not have access to a bus stop within a 1 km radius.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Krzysztof Dyba, Jakub Nowosad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
